graph TB
    subgraph Clients["ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå±¤"]
        CLI["fumi CLI<br/>(Rust/clap)"]
        TUI["fumi TUI<br/>(Rust/Ratatui)"]
        NVIM["fumi.nvim<br/>(Lua + Telescope)"]
        WEB["fumi Web<br/>(React + PWA)"]
    end

    subgraph Daemon["fumid â€” ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ãƒ¢ãƒ³"]
        API["API Layer<br/>JSON-RPC + REST"]
        SCHED["Scheduler<br/>ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¸ãƒ§ãƒ–"]
        IDX["Indexer<br/>FTS5 / Vecæ›´æ–°"]
        SYNCM["Sync Manager<br/>å¤‰æ›´ã‚­ãƒ¥ãƒ¼ç®¡ç†"]
        LLMM["LLM Manager<br/>Embedding/æ¨è«–"]
    end

    subgraph Storage["ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸"]
        SQLITE[("SQLite<br/>ãƒ¡ãƒ¢ãƒ»ã‚¿ã‚°ãƒ»ã‚¿ã‚¹ã‚¯")]
        FTS[("FTS5 Index<br/>å…¨æ–‡æ¤œç´¢")]
        VEC[("sqlite-vec<br/>æ„å‘³æ¤œç´¢")]
        FILES["ğŸ“ Attachments<br/>ç”»åƒãƒ»ãƒ•ã‚¡ã‚¤ãƒ«"]
    end

    subgraph Remote["ãƒªãƒ¢ãƒ¼ãƒˆ (Optional)"]
        SYNC["Sync Server<br/>(Rust/axum)"]
        PG[("PostgreSQL<br/>+ pgvector")]
        S3["Object Store<br/>(S3/MinIO)"]
    end

    subgraph LLM["LLMãƒ—ãƒ­ãƒã‚¤ãƒ€"]
        OLLAMA["Ollama<br/>(ãƒ­ãƒ¼ã‚«ãƒ«)"]
        CLAUDE["Anthropic API"]
        ONNX["ONNX Runtime<br/>(Embedding)"]
    end

    CLI -->|Unix Socket| API
    TUI -->|Unix Socket| API
    NVIM -->|Unix Socket| API
    WEB -->|HTTP localhost| API

    API --> SQLITE
    API --> FTS
    API --> VEC
    API --> FILES

    SCHED --> IDX
    SCHED --> SYNCM
    SCHED --> LLMM

    IDX --> FTS
    IDX --> VEC

    SYNCM -->|"ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ™‚<br/>ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰"| SYNC

    SYNC --> PG
    SYNC --> S3

    LLMM --> OLLAMA
    LLMM --> CLAUDE
    LLMM --> ONNX

    style Clients fill:#1e293b,stroke:#3b82f6,color:#e2e8f0
    style Daemon fill:#1e293b,stroke:#10b981,color:#e2e8f0
    style Storage fill:#1e293b,stroke:#f59e0b,color:#e2e8f0
    style Remote fill:#1e293b,stroke:#8b5cf6,color:#e2e8f0
    style LLM fill:#1e293b,stroke:#ec4899,color:#e2e8f0
